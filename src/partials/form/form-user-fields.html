<!-- Form Grid Layout -->
<div class="grid grid-cols-1 gap-6 md:grid-cols-2">
  <!-- Account Info Section (Left Column) -->
  <div
    class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]"
  >
    <h3 class="mb-6 text-lg font-semibold text-gray-800 dark:text-white/90">
      Account Info
    </h3>

    <div class="space-y-5">
      <!-- Email Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Email <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <input
            type="email"
            id="email"
            name="email"
            required
            x-model="formData.email"
            placeholder="Masukkan alamat email"
            class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
          />
        </div>
        <p class="mt-1.5 hidden text-xs text-red-500" id="email-error">
          Format email tidak valid
        </p>
      </div>
      <!-- Password Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Password
          <span x-show="!isEditMode" class="text-red-500">*</span>
          <span x-show="isEditMode" class="text-xs text-gray-500"
            >(Opsional)</span
          >
        </label>
        <div class="relative">
          <input
            type="password"
            id="password"
            name="password"
            x-model="formData.password"
            :required="!isEditMode"
            :placeholder="isEditMode ? 'Kosongkan jika tidak ingin mengubah password' : 'Masukkan password'"
            class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
          />
          <button
            type="button"
            onclick="togglePassword('password')"
            class="absolute top-1/2 right-3.5 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"
          >
            <svg
              id="password-eye"
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M8 3C4.5 3 1.73 5.61 1 8c.73 2.39 3.5 5 7 5s6.27-2.61 7-5c-.73-2.39-3.5-5-7-5zM8 11.5c-1.93 0-3.5-1.57-3.5-3.5S6.07 4.5 8 4.5s3.5 1.57 3.5 3.5S9.93 11.5 8 11.5zM8 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"
                fill="currentColor"
              />
            </svg>
          </button>
        </div>
      </div>

      <!-- Confirm Password Field -->
      <div x-show="formData.password.trim() !== ''">
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Konfirmasi Password <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            x-model="formData.confirmPassword"
            placeholder="Konfirmasi password"
            class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
          />
          <button
            type="button"
            onclick="togglePassword('confirmPassword')"
            class="absolute top-1/2 right-3.5 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"
          >
            <svg
              id="confirmPassword-eye"
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M8 3C4.5 3 1.73 5.61 1 8c.73 2.39 3.5 5 7 5s6.27-2.61 7-5c-.73-2.39-3.5-5-7-5zM8 11.5c-1.93 0-3.5-1.57-3.5-3.5S6.07 4.5 8 4.5s3.5 1.57 3.5 3.5S9.93 11.5 8 11.5zM8 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"
                fill="currentColor"
              />
            </svg>
          </button>
        </div>
      </div>
      <!-- Role Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Role <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <select
            id="role"
            name="role"
            required
            x-model="formData.id_roles"
            :disabled="isLoadingMasters"
            class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
            :class="{ 'opacity-50 cursor-not-allowed': isLoadingMasters }"
          >
            <option value="" disabled>
              <span x-show="!isLoadingMasters">Select Role</span>
            </option>
            <template x-for="role in masterData.roles" :key="role.id">
              <option :value="role.id" x-text="role.name"></option>
            </template>
          </select>
          <span
            class="pointer-events-none absolute top-1/2 right-3.5 -translate-y-1/2"
          >
            <svg
              width="12"
              height="12"
              viewBox="0 0 12 12"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M2.5 4.5L6 8L9.5 4.5"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>
        </div>
      </div>
      <!-- Programs Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Program <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <select
            id="program"
            name="program"
            required
            x-model="formData.id_programs"
            :disabled="isLoadingMasters"
            @change="updatePositionsForProgram($event.target.value)"
            class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
            :class="{ 'opacity-50 cursor-not-allowed': isLoadingMasters }"
          >
            <option value="" disabled>
              <span x-show="!isLoadingMasters">Select Program</span>
            </option>
            <template x-for="program in masterData.programs" :key="program.id">
              <option :value="program.id" x-text="program.name"></option>
            </template>
          </select>
          <span
            class="pointer-events-none absolute top-1/2 right-3.5 -translate-y-1/2"
          >
            <svg
              width="12"
              height="12"
              viewBox="0 0 12 12"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M2.5 4.5L6 8L9.5 4.5"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>
        </div>
      </div>
      <!-- Position Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Position <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <select
            id="position"
            name="position"
            required
            x-model="formData.id_position"
            :disabled="!formData.id_programs || isLoadingPositions"
            class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
            :class="{ 'opacity-50 cursor-not-allowed': !formData.id_programs || isLoadingPositions }"
          >
            <option value="" disabled x-text="positionPlaceholder"></option>
            <template x-if="!isLoadingPositions">
              <template
                x-for="position in masterData.positions"
                :key="position.id"
              >
                <option :value="position.id" x-text="position.name"></option>
              </template>
            </template>
          </select>
          <span
            class="pointer-events-none absolute top-1/2 right-3.5 -translate-y-1/2"
          >
            <!-- Loading spinner when fetching positions -->
            <template x-if="isLoadingPositions">
              <svg
                class="h-4 w-4 animate-spin text-gray-400"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
            </template>
            <!-- Default dropdown arrow when not loading -->
            <template x-if="!isLoadingPositions">
              <svg
                width="12"
                height="12"
                viewBox="0 0 12 12"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M2.5 4.5L6 8L9.5 4.5"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </template>
          </span>
        </div>
        <!-- Position error message -->
        <template x-if="positionErrorMessage">
          <p
            class="mt-1 text-xs text-red-500"
            x-text="positionErrorMessage"
          ></p>
        </template>
      </div>
    </div>
  </div>

  <!-- Personal Information Section (Right Column) -->
  <div
    class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]"
  >
    <h3 class="mb-6 text-lg font-semibold text-gray-800 dark:text-white/90">
      Personal Information
    </h3>

    <div class="space-y-5">
      <!-- Full Name Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Full Name <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="fullName"
          name="fullName"
          required
          x-model="formData.full_name"
          placeholder="Masukkan nama lengkap"
          class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
        />
      </div>
      <!-- NIP/NIM Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          NIP / NIM <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="nipNim"
          name="nipNim"
          required
          x-model="formData.nip_nim"
          placeholder="Masukkan NIP atau NIM"
          class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
        />
      </div>
      <!-- Phone Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Phone Number <span class="text-red-500">*</span>
        </label>
        <input
          type="tel"
          id="phone"
          name="phone"
          required
          x-model="formData.phone"
          placeholder="+62 8XX XXXX XXXX"
          class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
        />
      </div>
      <!-- Division Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Division <span class="text-red-500">*</span>
        </label>
        <div class="relative">
          <select
            id="division"
            name="division"
            required
            x-model="formData.id_divisions"
            :disabled="isLoadingMasters"
            class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 pr-11 text-sm text-gray-800 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90"
            :class="{ 'opacity-50 cursor-not-allowed': isLoadingMasters }"
          >
            <option value="" disabled>
              <span x-show="!isLoadingMasters">Select Division</span>
            </option>
            <template
              x-for="division in masterData.divisions"
              :key="division.id"
            >
              <option :value="division.id" x-text="division.name"></option>
            </template>
          </select>
          <span
            class="pointer-events-none absolute top-1/2 right-3.5 -translate-y-1/2"
          >
            <svg
              width="12"
              height="12"
              viewBox="0 0 12 12"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M2.5 4.5L6 8L9.5 4.5"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </span>
        </div>
      </div>
      <!-- Upload Photo Field -->
      <div>
        <label
          class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
        >
          Upload Foto Profil <span class="text-red-500">*</span>
        </label>
        <div
          class="dropzone hover:border-brand-500 dark:hover:border-brand-500 rounded-xl border border-dashed border-gray-300 bg-gray-50 p-6 dark:border-gray-700 dark:bg-gray-900"
          id="photo-dropzone"
        >
          <div class="text-center">
            <div class="mb-4 flex justify-center">
              <div
                class="flex h-12 w-12 items-center justify-center rounded-full bg-gray-200 text-gray-700 dark:bg-gray-800 dark:text-gray-400"
              >
                <svg
                  class="fill-current"
                  width="20"
                  height="20"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M10 2C10.2652 2 10.5196 2.10536 10.7071 2.29289L15.7071 7.29289C16.0976 7.68342 16.0976 8.31658 15.7071 8.70711C15.3166 9.09763 14.6834 9.09763 14.2929 8.70711L11 5.41421V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V5.41421L5.70711 8.70711C5.31658 9.09763 4.68342 9.09763 4.29289 8.70711C3.90237 8.31658 3.90237 7.68342 4.29289 7.29289L9.29289 2.29289C9.48043 2.10536 9.73478 2 10 2Z"
                    fill=""
                  />
                </svg>
              </div>
            </div>
            <h4 class="mb-2 font-medium text-gray-800 dark:text-white/90">
              Drop File Here
            </h4>            <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
              Drag and drop your PNG, JPEG, JPG, WebP images here or
              <button
                type="button"
                class="text-brand-500 hover:underline"
                @click="$refs.photoInput.click()"
              >
                browse
              </button>
            </p>
            <p class="text-xs text-gray-400">Max: 20MB</p>
          </div>
          <input
            type="file"
            id="photo-input"
            name="face_photo"
            accept=".png,.jpeg,.jpg,.webp,image/png,image/jpeg,image/jpg,image/webp"
            :required="!isEditMode"
            class="hidden"
            x-ref="photoInput"
            @change="handleFileChange($event)"
          />
        </div>        <!-- Photo Preview Section -->
        <div
          x-show="photoPreview || (isEditMode && currentPhotoUrl) || isLoadingPhotoPreview"
          class="mt-3"
        >
          <!-- Loading state -->
          <div x-show="isLoadingPhotoPreview" class="flex items-center space-x-2">
            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
            <span class="text-sm text-gray-600 dark:text-gray-400">Loading preview...</span>
          </div>

          <!-- New photo preview (from file input) -->
          <div x-show="photoPreview && !isLoadingPhotoPreview">
            <img
              :src="photoPreview"
              class="h-20 w-20 rounded-lg object-cover"
              alt="New Photo Preview"
            />
            <!-- File info -->
            <div x-show="photoFileInfo" class="mt-2 text-xs text-gray-500">
              <p x-text="photoFileInfo?.name"></p>
              <p x-text="photoFileInfo?.size"></p>
            </div>
            <button
              type="button"
              @click="removePhoto()"
              class="mt-2 text-xs text-red-500 hover:underline"
            >
              Remove New Photo
            </button>
          </div>

          <!-- Current photo preview (for edit mode) -->
          <div
            x-show="!photoPreview && isEditMode && currentPhotoUrl"
            class="space-y-2"
          >
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Current Photo:
            </p>
            <img
              :src="currentPhotoUrl"
              class="h-20 w-20 rounded-lg object-cover"
              alt="Current Photo"
            />
            <p class="text-xs text-gray-500">
              Upload a new file to replace this photo
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Address Section (Full Width) -->
<div
  class="rounded-2xl border border-gray-200 bg-white p-6 dark:border-gray-800 dark:bg-white/[0.03]"
>
  <h5 class="mb-2 font-medium text-black dark:text-white">Address</h5>
  <p class="mb-4 text-sm text-gray-500 dark:text-gray-400">Detail Alamat</p>

  <div class="mb-6 grid grid-cols-1 gap-5 md:grid-cols-3">
    <!-- Latitude -->
    <div>
      <label
        class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
      >
        Latitude
      </label>
      <input
        type="text"
        id="latitude"
        name="latitude"
        x-model="formData.latitude"
        placeholder="-"
        class="h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-500 select-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400"
        readonly
        onselectstart="return false"
        onmousedown="return false"
      />
    </div>

    <!-- Longitude -->
    <div>
      <label
        class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
      >
        Longitude
      </label>
      <input
        type="text"
        id="longitude"
        name="longitude"
        x-model="formData.longitude"
        placeholder="-"
        class="h-11 w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm text-gray-500 select-none dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400"
        readonly
        onselectstart="return false"
        onmousedown="return false"
      />
    </div>
    <!-- Radius -->
    <div>
      <label
        class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
      >
        Radius (meter)
      </label>
      <input
        type="number"
        id="radius"
        name="radius"
        x-model="formData.radius"
        @input="updateMapRadius()"
        placeholder="Contoh: 50"
        min="10"
        max="1000"
        class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
      />
    </div>
  </div>
  <!-- Map Section -->
  <div class="space-y-3">
    <p class="font-medium text-black dark:text-white">Pencarian Lokasi</p>
    <p class="text-sm text-gray-500 dark:text-gray-400">
      Masukkan nama tempat atau geser marker pada peta.
    </p>

    <!-- Map Search Input with Search Button -->
    <div class="flex gap-2">
      <input
        type="text"
        id="mapSearchQuery"
        x-model="mapSearchQuery"
        placeholder="Cari lokasi (minimal 3 karakter)..."
        @keyup.enter="searchLocation()"
        class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 flex-1 rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
      />
      <button
        type="button"
        @click="searchLocation()"
        :disabled="isSearchingLocation || mapSearchQuery.length < 3"
        class="bg-brand-500 hover:bg-brand-600 flex h-11 items-center gap-2 rounded-lg px-4 text-white transition-colors disabled:cursor-not-allowed disabled:bg-gray-400"
      >
        <svg
          x-show="!isSearchingLocation"
          class="h-4 w-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
          ></path>
        </svg>
        <svg
          x-show="isSearchingLocation"
          class="h-4 w-4 animate-spin"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
        <span x-text="isSearchingLocation ? 'Cari...' : 'Cari'"></span>
      </button>
    </div>

    <!-- Search Results -->
    <div
      x-show="searchResults.length > 0"
      class="max-h-40 overflow-y-auto rounded-lg border border-gray-200 bg-white shadow-sm dark:border-gray-700 dark:bg-gray-800"
    >
      <template x-for="(result, index) in searchResults" :key="index">
        <button
          type="button"
          @click="selectSearchResult(result)"
          class="w-full border-b border-gray-100 px-4 py-2 text-left last:border-b-0 hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700"
        >
          <p
            class="truncate text-sm font-medium text-gray-800 dark:text-white"
            x-text="result.display_name.split(',')[0]"
          ></p>
          <p
            class="truncate text-xs text-gray-500 dark:text-gray-400"
            x-text="result.display_name"
          ></p>
        </button>
      </template>
    </div>

    <!-- Description Field -->
    <input
      type="text"
      id="description"
      x-model="formData.description"
      placeholder="Deskripsi lokasi akan terisi otomatis..."
      class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
    />

    <!-- Map Container -->
    <div class="relative">
      <div
        id="mapContainer"
        class="h-80 w-full overflow-hidden rounded-lg border border-gray-200 dark:border-gray-700"
        x-ref="mapContainer"
      ></div>
      <div
        x-show="!mapInitialized"
        class="absolute inset-0 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-800"
      >
        <div class="text-center">
          <svg
            class="mx-auto h-8 w-8 animate-spin text-gray-400"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">
            Memuat peta...
          </p>
        </div>
      </div>
    </div>

    <!-- Map Instructions -->
    <div
      class="rounded-lg border border-blue-200 bg-blue-50 p-3 dark:border-blue-800 dark:bg-blue-900/20"
    >
      <p class="text-sm text-blue-700 dark:text-blue-300">
        <strong>Cara menggunakan peta:</strong>
      </p>
      <ul class="mt-1 space-y-1 text-sm text-blue-600 dark:text-blue-400">
        <li>• Klik pada peta untuk menempatkan marker</li>
        <li>• Seret marker untuk mengubah posisi</li>
        <li>• Gunakan kotak pencarian untuk mencari lokasi spesifik</li>
        <li>• Sesuaikan radius geofence menggunakan input radius di atas</li>
      </ul>
    </div>
  </div>
  <!-- Action Buttons -->
  <div class="flex justify-end gap-4 pt-4">
    <button
      type="button"
      @click="cancelForm()"
      :disabled="isSaving"
      class="rounded-lg border border-gray-300 px-5 py-2 text-gray-700 transition-colors hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-50 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-gray-700"
    >
      Batal
    </button>
    <button
      type="submit"
      @click.prevent="submitForm()"
      :disabled="isSaving || isLoadingMasters"
      class="bg-brand-500 hover:bg-brand-600 rounded-lg px-5 py-2 text-white transition-colors disabled:cursor-not-allowed disabled:opacity-50"
    >
      <span
        x-show="!isSaving"
        x-text="isEditMode ? 'Update User' : 'Create User'"
      ></span>
      <span x-show="isSaving">
        <svg
          class="mr-2 -ml-1 inline-block h-4 w-4 animate-spin text-white"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle
            class="opacity-25"
            cx="12"
            cy="12"
            r="10"
            stroke="currentColor"
            stroke-width="4"
          ></circle>
          <path
            class="opacity-75"
            fill="currentColor"
            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
          ></path>
        </svg>
        <span x-text="isEditMode ? 'Updating...' : 'Creating...'"></span>
      </span>
    </button>
  </div>
</div>
