<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>
      Tambah User | InfiniteTrack - Tailwind CSS Admin Dashboard Template
    </title>
  </head>
  <body
    x-data="{ page: 'managementUser', 'loaded': true, 'darkMode': false, 'stickyMenu': false, 'sidebarToggle': false, 'scrollTop': false }"
    x-init="
         darkMode = JSON.parse(localStorage.getItem('darkMode'));
         $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)))"
    :class="{'dark bg-gray-900': darkMode === true}"
  >
    <!-- ===== Preloader Start ===== -->
    <include src="./partials/common/preloader.html"></include>
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
      <!-- ===== Sidebar Start ===== -->
      <include src="./partials/common/sidebar.html"></include>
      <!-- ===== Sidebar End ===== -->

      <!-- ===== Content Area Start ===== -->
      <div
        class="relative flex flex-1 flex-col overflow-x-hidden overflow-y-auto"
      >
        <!-- Small Device Overlay Start -->
        <include src="./partials/common/overlay.html" />
        <!-- Small Device Overlay End -->

        <!-- ===== Header Start ===== -->
        <include src="./partials/common/header.html" />
        <!-- ===== Header End ===== -->

        <!-- ===== Main Content Start ===== -->
        <main>
          <div class="mx-auto max-w-(--breakpoint-2xl) p-4 md:p-6">
            <!-- Breadcrumb Start -->
            <div x-data="{ pageName: `Tambah User`}">
              <include src="./partials/common/breadcrumb.html" />
            </div>
            <!-- Breadcrumb End -->
            <!-- ====== Tambah User Form Start -->
            <form id="addUserForm" class="space-y-6">
              <!-- Include Form Fields Partial -->
              <include src="./partials/form/form-user-fields.html" />
            </form>
            <!-- ====== Tambah User Form End -->
          </div>
        </main>
        <!-- ===== Main Content End ===== -->
      </div>
      <!-- ===== Content Area End ===== -->
    </div>
    <!-- ===== Page Wrapper End ===== -->

    <script>
      // Toggle Password Visibility
      function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const eye = document.getElementById(inputId + "-eye");

        if (input.type === "password") {
          input.type = "text";
          eye.innerHTML = `
            <path d="M2 8s3-5.5 6-5.5S14 8 14 8s-3 5.5-6 5.5S2 8 2 8z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M8 11a3 3 0 100-6 3 3 0 000 6z" fill="none" stroke="currentColor" stroke-width="2"/>
            <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"/>
          `;
        } else {
          input.type = "password";
          eye.innerHTML = `
            <path d="M8 3C4.5 3 1.73 5.61 1 8c.73 2.39 3.5 5 7 5s6.27-2.61 7-5c-.73-2.39-3.5-5-7-5zM8 11.5c-1.93 0-3.5-1.57-3.5-3.5S6.07 4.5 8 4.5s3.5 1.57 3.5 3.5S9.93 11.5 8 11.5zM8 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" fill="currentColor"/>
          `;
        }
      }

      // File Upload Functions
      function dragOverHandler(ev) {
        ev.preventDefault();
        ev.currentTarget.classList.add(
          "border-brand-500",
          "bg-brand-50",
          "dark:bg-brand-900/20",
        );
      }
      function dragEnterHandler(ev) {
        ev.preventDefault();
        ev.currentTarget.classList.add(
          "border-brand-500",
          "bg-brand-50",
          "dark:bg-brand-900/20",
        );
      }

      function dragLeaveHandler(ev) {
        ev.preventDefault();
        if (!ev.currentTarget.contains(ev.relatedTarget)) {
          ev.currentTarget.classList.remove(
            "border-brand-500",
            "bg-brand-50",
            "dark:bg-brand-900/20",
          );
        }
      }

      function dropHandler(ev) {
        ev.preventDefault();
        ev.currentTarget.classList.remove(
          "border-brand-500",
          "bg-brand-50",
          "dark:bg-brand-900/20",
        );

        const files = ev.dataTransfer.files;
        if (files.length > 0) {
          handleFileUpload(files[0]);
        }
      }

      function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) {
          handleFileUpload(file);
        }
      }

      function handleFileUpload(file) {
        // Validate file type
        const allowedTypes = ["image/png", "image/jpeg", "image/jpg"];
        if (!allowedTypes.includes(file.type)) {
          alert("Format file tidak didukung. Gunakan PNG, JPEG, atau JPG.");
          return;
        }

        // Validate file size (2MB)
        const maxSize = 2 * 1024 * 1024; // 2MB in bytes
        if (file.size > maxSize) {
          alert("Ukuran file terlalu besar. Maksimal 2MB.");
          return;
        }

        // Create preview
        const reader = new FileReader();
        reader.onload = function (e) {
          const preview = document.getElementById("photo-preview");
          const previewImage = document.getElementById("preview-image");

          previewImage.src = e.target.result;
          preview.classList.remove("hidden");

          // Hide dropzone text
          document.getElementById("photo-dropzone").style.display = "none";
        };
        reader.readAsDataURL(file);
      }

      function removePhoto() {
        const preview = document.getElementById("photo-preview");
        const photoInput = document.getElementById("photo-input");
        const dropzone = document.getElementById("photo-dropzone");

        preview.classList.add("hidden");
        photoInput.value = "";
        dropzone.style.display = "block";
      }

      // Form Validation
      document
        .getElementById("addUserForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // Validate email
          const email = document.getElementById("email").value;
          const emailError = document.getElementById("email-error");
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

          if (!emailRegex.test(email)) {
            emailError.classList.remove("hidden");
            return;
          } else {
            emailError.classList.add("hidden");
          }

          // If validation passes, you can submit the form
          alert("Form submitted successfully!");
          // Here you would typically send the data to your server
        });
    </script>
  </body>
</html>
